<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Protect Webhook - Admin</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div id="hb-protect-ui">
  <header class="hb-ui-header">
    <h1>Webhook & Email - Admin (Integrato)</h1>
  </header>
  <main class="hb-ui-main">
    <section class="hb-ui-section">
      <div style="display:flex; gap:.5rem; align-items:center;">
        <span id="diagMsg" class="status"></span>
      </div>
    </section>
    <section class="hb-ui-section">
      <h2>Webhooks</h2>
      <div id="saveNotice" class="notice hidden">Le modifiche alla configurazione (Crea/Elimina) potrebbero richiedere di premere "Salva" in alto per applicarle, a seconda della vista.</div>
      <div style="display:flex; gap:.5rem; align-items:flex-end; flex-wrap:wrap; margin: .25rem 0 .5rem;">
        <form id="whAddForm" style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:flex-end;">
          <label>Nome (senza spazi)<br><input type="text" id="whName" required placeholder="es. PortaIngresso"/></label>
          <button class="action" type="submit">Crea Webhook</button>
        </form>
      </div>
      <table id="webhooksTable" class="hb-ui-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Percorso</th>
            <th>URL Base</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section class="hb-ui-section">
      <h2>Email Triggers</h2>
      <div style="display:flex; gap:.5rem; align-items:flex-end; flex-wrap:wrap; margin: .25rem 0 .5rem;">
        <form id="emAddForm" style="display:flex; gap:.5rem; flex-wrap:wrap; align-items:flex-end;">
          <label>Nome<br><input type="text" id="emName" required placeholder="es. Reolink"/></label>
          <label>IMAP Host<br><input type="text" id="emImapHost" required placeholder="imap.gmail.com"/></label>
          <label>IMAP User<br><input type="text" id="emImapUser" required placeholder="utente@gmail.com"/></label>
          <label>IMAP Password<br><input type="password" id="emImapPassword" required placeholder="App Password"/></label>
          <label>Subject Match<br><input type="text" id="emSubject" required placeholder="Reolink Alert"/></label>
          <label>Debounce (s)<br><input type="number" id="emDebounce" min="0" value="0"/></label>
          <label>Durata (s)<br><input type="number" id="emDuration" min="1" value="10"/></label>
          <button class="action" type="submit">Aggiungi Trigger</button>
        </form>
      </div>
      <table id="emailTable" class="hb-ui-table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Host IMAP</th>
            <th>Debounce (s)</th>
            <th>Durata Evento (s)</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="ephemeralOutput" class="hb-ui-section hidden">
      <h2>Output</h2>
      <pre id="ephemeralContent"></pre>
      <button id="copyOutputBtn" class="action" type="button" style="margin-top:.5rem;">Copia URL</button>
    </section>
  </main>
  <footer class="hb-ui-footer">
    <small>UI integrata in Homebridge - Non espone segreti nei log</small>
  </footer>
  </div>
  <script src="./ui-app.js" type="module"></script>
</body>
</html>
